<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.0</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    {load href="__ADMIN__/favicon.ico"/}
    {load href="__ADMIN__/css/font.css" /}
    {load href="__ADMIN__/css/xadmin.css" /}
    {load href="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js" /}
    {load href="__ADMIN__/lib/layui/layui.js" charset="utf-8" /}
    {load href="__ADMIN__/js/xadmin.js" /}
  </head>

  <body>
    <div class="x-body">
        <form class="layui-form">
          <div class="layui-form-item" style="float: left;position: relative;left:50%;margin-top:60px;">
              <button class="layui-btn" style="position: relative;left:-50%;">
                  <a href="{:url('Member/downMould')}" style="color:#fff;">
                      <i class="layui-icon">&#xe61d;</i>下载模板
                      <br/>
                      <span style="color:rgb(34, 34, 34);">（请先下载导入数据的模板，不要改动第一行）</span>
                  </a>
              </button>
              <button type="button" class="layui-btn" id="test3" style="display:block;position: relative;left: -50%;margin-top:50px;margin-left:-3px; width:288px;"><i class="layui-icon"></i>导入客户
                  <br/>
                  <span style="color:rgb(34, 34, 34);">（点击导入填写好的数据）</span>
              </button>
          </div>
      </form>
    </div>
    <script>
    layui.use('upload', function(){
        var $ = layui.jquery
        ,upload = layui.upload;
        //指定允许上传的文件类型
        upload.render({
            elem: '#test3'
            ,url: '{:url("Member/importMember")}'
            ,accept: 'file' //普通文件
            ,done: function(res){
                if(res.status == 1)
                {
                    var type = 'auto';
                    var text = '文件上传成功！是否立即检测天提交数据！';
                    layer.open({
                        type: 1
                        ,offset: type
                        ,id: 'layerDemo'+type //防止重复弹出
                        ,content: '<div style="padding: 20px 100px;">'+ text +'</div>'
                        ,btn: ['立即更新', '取消操作']
                        ,btnAlign: 'c' //按钮居中
                        ,shade: 0 //不显示遮罩
                        ,yes: function(){
                            // 触发检测数据
                            checkdata(res.symbol);
                        }
                        ,btn2: function(){
                            layer.closeAll();
                        }
                    });
                }else if(res.status == '-1'){
                    var type = 'auto';
                    var text = '文件不存在数据！请重新下载模板填写！';
                    layer.open({
                        type: 1
                        ,offset: type
                        ,id: 'layerDemo'+type //防止重复弹出
                        ,content: '<div style="padding: 20px 100px;">'+ text +'</div>'
                        ,btn: '关闭全部'
                        ,btnAlign: 'c' //按钮居中
                        ,shade: 0 //不显示遮罩
                        ,yes: function(){
                            layer.closeAll();
                        }
                    });
                }else {
                    var type = 'auto';
                    var text = '文件上传失败了！';
                    layer.open({
                        type: 1
                        ,offset: type
                        ,id: 'layerDemo'+type //防止重复弹出
                        ,content: '<div style="padding: 20px 100px;">'+ text +'</div>'
                        ,btn: '关闭全部'
                        ,btnAlign: 'c' //按钮居中
                        ,shade: 0 //不显示遮罩
                        ,yes: function(){
                            layer.closeAll();
                        }
                    });
                }
            }
        });
    });
    function checkdata(symbol)
    {
        $.ajax({
			url:"{:url('Member/leadMember')}",
			type:'post',
			dataType:'json',
			data: {symbol: symbol},
            // 请求发送之前
            beforeSend:function(XMLHttpRequest){
                var i = $('#layerDemoauto');
                i.html("<div style='padding: 20px 100px;'>正在请求服务器更新数据!请稍后···</div>");
                var x = $('.layui-layer-btn a.layui-layer-btn0');
                x.hide();
            },
			success:function(msg){
                if(msg.status == 1){
                    var i = $('#layerDemoauto');
                    var x = $('.layui-layer-btn a.layui-layer-btn0');
                    var y = $('.layui-layer-btn a.layui-layer-btn1');
                    i.html('<div style="padding: 20px 100px;">数据上传结束！操作成功'+msg.success+'条！,操作失败'+msg.error+'条！</div>');
                    x.hide();
                    y.text('确定');
                }else {
                    var i = $('#layerDemoauto');
                    var x = $('.layui-layer-btn a.layui-layer-btn0');
                    var y = $('.layui-layer-btn a.layui-layer-btn1');
                    i.html('<div style="padding: 20px 100px;">操作失败了！请稍后再试！</div>');
                    x.hide();
                    y.text('结束操作');
                }
			},
		});
    }
    </script>
  </body>

</html>
